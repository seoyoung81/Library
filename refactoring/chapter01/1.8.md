# âœï¸ 1.8 ë‹¤í˜•ì„±ì„ í™œìš©í•´ ê³„ì‚° ì½”ë“œ ì¬êµ¬ì„±í•˜ê¸°

â­ï¸ ê¸°ëŠ¥ ìˆ˜ì •&#x20;

### ëª©í‘œ

ì—°ê·¹ ì¥ë¥´ë¥¼ ì¶”ê°€í•˜ê³  ì¥ë¥´ë§ˆë‹¤ ê³µì—°ë£Œì™€ ì ë¦½ í¬ì¸íŠ¸ ê³„ì‚°ë²•ì„ ë‹¤ë¥´ê²Œ ì§€ì •í•˜ë„ë¡ ê¸°ëŠ¥ì„ ìˆ˜ì •í•´ë³´ì. í˜„ì¬ ìƒíƒœì—ì„œëŠ” ì¡°ê±´ë¬¸ì„ ìˆ˜ì •í•´ì•¼í•œë‹¤. ì´ëŸ° í˜•íƒœì˜ ì¡°ê±´ë¶€ ë¡œì§ì€ ì½”ë“œ ìˆ˜ì • íšŸìˆ˜ê°€ ëŠ˜ì–´ë‚ ìˆ˜ë¡ ê³¨ì¹«ê±°ë¦¬ë¡œ ì „ë½í•˜ê¸° ì‰½ë‹¤. **ì¡°ê±´ë¶€ ë¡œì§ì„ ëª…í™•í•œ êµ¬ì¡°ë¡œ ë³´ì™„í•´ë³´ì.**

ê°ì²´ì§€í–¥ì˜ í•µì‹¬ íŠ¹ì„±ì¸ ë‹¤í–¥ì„±(polymorphism)ì„ í™œìš©í•˜ëŠ” ê²ƒì´ ìì—°ìŠ¤ëŸ½ë‹¤. í¬ê·¹ ì„œë¸Œí´ë˜ìŠ¤ì™€ ë¹„ê·¹ ì„œë¸Œí´ë˜ìŠ¤ê°€ ê°ìì˜ êµ¬ì²´ì ì¸ ê³„ì‚° ë¡œì§ì„ ì •ì˜í•˜ëŠ” ê²ƒì´ë‹¤.

* í˜¸ì¶œí•˜ëŠ” ìª½: ë‹¤í˜•ì„± ë²„ì „ì˜ ê³µì—°ë£Œ ê³„ì‚° í•¨ìˆ˜ë¥¼ í˜¸ì¶œ
* ì—°ê²°í•˜ëŠ” ìª½: í¬ê·¹ or ë¹„ê·¹ì´ëƒì— ë”°ë¼ ì •í™•í•œ ê³„ì‚° ë¡œì§ì„ ì—°ê²°

### ì¡°ê±´ë¶€ ë¡œì§ì„ ë‹¤í˜•ì„±ìœ¼ë¡œ ë°”ê¾¸ê¸°

1. ì¡°ê±´ë¶€ ì½”ë“œ í•œ ë©ì–´ë¦¬ë¥¼ ë‹¤í˜•ì„±ìœ¼ë¡œ í™œìš©í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë°”ê¿”ì¤€ë‹¤.
2. ìƒì† ê³„ì¸µ ë¶€í„° ì •ì˜í•´ì•¼ í•œë‹¤.

```javascript
export default function createStatementData(invoice, plays) {
  const result = {};
  result.customer = invoice.customer; 
  result.performances = invoice.performances.map(enrichPerformance);
  result.totalAmount = totalAmount(result);	
  result.totalVolumeCredits = totalVolumeCredits(result);
  return result;
  
  function enrichPerformance(aPerformance) {
    const result = Object.assign({}, aPerformance); 
    result.play = playFor(result); 
    result.amount = amountFor(result);
    result.volumeCredits = volumeCreidtsFor(result);
    return result;
  }
  
  function playFor(aPerformance) {
    return plays[aPerformance.playID]
  }
  
  function amountFor(aPerformance) {
    let result = 0;
    switch (aPerformance.play.type) { 
    case "tragedy":
      result = 40000;
      if (perf.audience > 30) {
        result += 1000 * (aPerformance.audience - 30);
      }
      break;
    case "comedy":
      result = 30000;
      if (perf.audience > 20) {
        result += 1000 + 500 * (aPerformance.audience - 20);
      }
      result += 300 * aPerformance.audience
      break;
    default:
      throw new Error(`ì•Œ ìˆ˜ ì—†ëŠ” ì¥ë¥´: ${aPerformance.play.type}`);
    }
    return result;
  }
  
  function volumeCreditsFor(aPerformance) {
    let result = 0;
    volumeCredits += Math.max(aPerformance.audience - 30, 0);
    if ("comedy" === playFor(aPerformance).type) 
      volumeCredits += Math.Floor(aPerformance.audience / 5 );
    return result;
  }
  
function totalAmount(data) {
  return data.performances 
    .reduce((total, p) => total + p.amount, 0);
}
function totalVolumeCredits(data) {
  return data.performances
    .reduce((total, p) => total + p.volumeCredits, 0); 
```

#### ê³µì—°ë£Œ ê³„ì‚°ê¸° ë§Œë“¤ê¸°

`enrichPerformance()` í•¨ìˆ˜: ê³µì—°ì˜ ì¤‘ê°„ ë°ì´í„° êµ¬ì¡°ì— ì±„ì›Œì£¼ëŠ”&#x20;

â†’ ì¡°ê±´ë¶€ ë¡œì§ì„ í¬í•¨í•œ `amountFor()` `volumeCreditsFor()`ë¥¼ í˜¸ì¶œí•˜ì—¬ ì ë¦½ í¬ì¸íŠ¸ë¥¼ ê³„ì‚°í•œë‹¤.

â†’ ë‘ í•¨ìˆ˜ë¥¼ ì „ìš© í´ë˜ìŠ¤ë¡œ ì˜®ê¸°ì (PerformanceCalculator)ë¼ ë¶€ë¥´ì

```javascript
function enrichPerformance(aPerformance) {
  const calculator = new PerformanceCalculator(aPerformance);  // ê³µì—°ë£Œ ê³„ì‚°ê¸° ìƒì„±
  const result = Object.assign({}, aPerformance); 
  result.play = playFor(result); 
  result.amount = amountFor(result);
  result.volumeCredits = volumeCreidtsFor(result);
  return result;
}
```

```javascript
class PerformanceCalculator {    // ê³µì—°ë£Œ ê³„ì‚°ê¸° í´ë˜ìŠ¤    
  constructor(aPerformance) {
    this.performance = aPerformance;
  }
}
```

ì´ í´ë˜ìŠ¤ì˜ ê°ì²´ë¡œ í•  ìˆ˜ ìˆëŠ” ì¼ì€ ì•„ì§ ì—†ë‹¤. **í•¨ìˆ˜ ì„ ì–¸ ë°”ê¾¸ê¸°**ë¥¼ ì ìš©í•˜ì—¬ ê³µì—°í•  ì—°ê·¹ì„ ê³„ì‚°ê¸°ë¡œ ì „ë‹¬í•œë‹¤.

```javascript
function enrichPerformance(aPerformance) {
  const calculator = new PerformanceCalculator(aPerformance, playFor(aPerformance);  // ê³µì—° ì •ë³´ë¥¼ ê³„ì‚°ê¸°ë¡œ ì „ë‹¬ 
  const result = Object.assign({}, aPerformance); 
  result.play = calculator.play;
  result.amount = amountFor(result);
  result.volumeCredits = volumeCreidtsFor(result);
  return result;
}
```

```javascript
class PerformanceCalculator {   
  constructor(aPerformance, aPlay) {
    this.performance = aPerformance;
    this.play = aPlay;
  }
}
```

#### í•¨ìˆ˜ë“¤ì„ ê³„ì‚°ê¸°ë¡œ ì˜®ê¸°ê¸°

ê³µì—°ë£Œ ê³„ì‚° ì½”ë“œë¥¼ ê³„ì‚°ê¸° í´ë˜ìŠ¤ ì•ˆìœ¼ë¡œ ë³µì‚¬í•œë‹¤. `aPerformance`ë¥¼ `this.performance`ë¡œ ë°”ê¾¸ê³  `playFor(aPerformance)`ë¥¼ `this.play`ë¡œ ë°”ê¿”ì¤€ë‹¤.

```javascript
get amount() { // amountFor() í•¨ìˆ˜ì˜ ì½”ë“œë¥¼ ê³„ì‚°ê¸° í´ë˜ìŠ¤ë¡œ ë³µì‚¬
  let result = 0;
    switch (this.play.type) {   // amountFor() í•¨ìˆ˜ê°€ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ë˜ ì •ë³´ë¥¼ ê³„ì‚°ê¸° í•„ë“œì—ì„œ ë°”ë¡œ ì–»ìŒ
    case "tragedy":
      result = 40000;
      if (this.performance.audience > 30) {
        result += 1000 * (this.performance.audience - 30);
      }
      break;
    case "comedy":
      result = 30000;
      if (this.performance.audience > 20) {
        result += 1000 + 500 * (this.performance.audience - 20);
      }
      result += 300 * this.performance.audience
      break;
    default:
      throw new Error(`ì•Œ ìˆ˜ ì—†ëŠ” ì¥ë¥´: ${this.play.type}`);
    }
  return result;
```

ë³µì‚¬í•œ í•¨ìˆ˜ê°€ ë™ì‘í•˜ê²Œë” ìˆ˜ì •í–ˆë‹¤ë©´ ì›ë³¸ í•¨ìˆ˜ê°€ ë°©ê¸ˆ ë§Œë“  í•¨ìˆ˜ë¡œ ì‘ì—…ì„ ìœ„ì„í•˜ë„ë¡ ë°”ê¾¼ë‹¤.

```javascript
function amountFor(aPerformance) {
  return new PerformanceCalculator(aPerformance, playFor(aPerformance)).amount;
}
```

ì›ë˜ **í•¨ìˆ˜ë¥¼ ì¸ë¼ì¸**í•˜ì—¬ ìƒˆ í•¨ìˆ˜ë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ë„ë¡ ìˆ˜ì •í•œë‹¤.

```javascript
function enrichPerformance(aPerformance) {
  const calculator = new PerformanceCalculator(aPerformance, playFor(aPerformance); 
  const result = Object.assign({}, aPerformance); 
  result.play = calculator.play;
  result.amount = calculator.amount;  // amountFor() ëŒ€ì‹  ê³„ì‚°ê¸°ì˜ í•¨ìˆ˜ ì´ìš©
  result.volumeCredits = volumeCreidtsFor(result);
  return result;
}
```

ì ë¦½ í¬ì¸íŠ¸ë¥¼ ê³„ì‚°í•˜ëŠ” í•¨ìˆ˜ë„ ê°™ì€ ë°©ë²•ìœ¼ë¡œ ì˜®ê¸´ë‹¤.

```javascript
get volumeCredits() {
  let result = 0;
  volumeCredits += Math.max(aPerformance.audience - 30, 0);
  if ("comedy" === playFor(aPerformance).type) 
    volumeCredits += Math.Floor(aPerformance.audience / 5 );
  return result;
}
```

```javascript
function enrichPerformance(aPerformance) {
  const calculator = new PerformanceCalculator(aPerformance, playFor(aPerformance); 
  const result = Object.assign({}, aPerformance); 
  result.play = calculator.play;
  result.amount = calculator.amount;  
  result.volumeCredits = calculator.volumeCredits;
  return result;
}
```



#### ê³µì—°ë£Œ ê³„ì‚°ê¸°ë¥¼ ë‹¤í˜•ì„± ë²„ì „ìœ¼ë¡œ ë§Œë“¤ê¸°

í´ë˜ìŠ¤ì— ë¡œì§ì„ ë‹´ì•˜ìœ¼ë‹ˆ ë‹¤í˜•ì„±ì„ ì§€ì›í•˜ê²Œ ë§Œë“¤ì.

ğŸ“ íƒ€ì… ì½”ë“œ ëŒ€ì‹  ì„œë¸Œí´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½í•˜ì. **íƒ€ì… ì½”ë“œë¥¼ ì„œë¸Œí´ë˜ìŠ¤ë¡œ ë°”ê¾¸ê¸°**

PerformanceCalculatorì˜ ì„œë¸Œí´ë˜ìŠ¤ë“¤ì„ ì¤€ë¹„í•˜ê³  createdStatementData()ì—ì„œ ê·¸ ì¤‘ ì í•©í•œ ì„œë¸Œ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê²Œ ë§Œë“¤ì–´ì•¼ í•œë‹¤. ê·¸ë¦¬ê³  ì„œë¸Œí´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ìƒì„±ì ëŒ€ì‹  í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë„ë¡ ë°”ê¿”ì•¼í•œë‹¤. ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ìƒì„±ìê°€ ì„œë¸Œí´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì´ë‹¤.&#x20;

â†’ **ìƒì„±ìë¥¼ íŒ©í„°ë¦¬ í•¨ìˆ˜ë¡œ ë°”ê¾¸ê¸°**ë¥¼ ì ìš©í•œë‹¤.

```javascript
function enrichPerformance(aPerformance) {
  const calculator = createPerformanceCalculator(aPerformance, playFor(aPerformance));   // ìƒì„±ì ëŒ€ì‹  íŒ©í„°ë¦¬ í•¨ìˆ˜ ì´ìš©
  const result = Object.assign({}, aPerformance); 
  result.play = calculator.play;
  result.amount = calculator.amount;  
  result.volumeCredits = calculator.volumeCredits;
  return result;
}
```

```javascript
function createPerformanceCalculator(aPerformance, aPlay) {
  return new PerformanceCalculator(aPerformance, aPlay);
}
```

í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ë©´ PerformanceCalculatorì˜ ì„œë¸Œí´ë˜ìŠ¤ ì¤‘ì—ì„œ ì–´ëŠ ê²ƒì„ ìƒì„±í•´ì„œ ë°˜í™˜í• ì§€ ì„ íƒí•  ìˆ˜ ìˆë‹¤.

```javascript
function createPerformanceCalculator(aPerformance, aPlay) {
  switch(aPlay.type) {
  case "tragedy": return new TragedyCalculator(aPerformance, aPlay);
  case "comedy": return new ComedyCalculator(aPerformance, aPlay);
  default:
    throw new Error(`ì•Œ ìˆ˜ ì—†ëŠ” ì¥ë¥´: ${aPlay.type}`);
  }
}

class TragedyCalculator extends PerformanceCalculator {
}
class ComedyCalculator extends PerformanceCalculator {
}
```

ë‹¤í˜•ì„±ì„ ì§€ì›í•˜ê¸° ìœ„í•œ êµ¬ì¡°ëŠ” ê°–ì¶°ì¡Œë‹¤.

ğŸ“ **ì¡°ê±´ë¶€ ë¡œì§ì„ ë‹¤í˜•ì„±ìœ¼ë¡œ ë°”ê¾¸ê¸°**ë¥¼ ì ìš©í•˜ì.

ğŸ¬ ë¹„ê·¹ ê³µì—°ì˜ ê³µì—°ë£Œ ê³„ì‚°

```javascript
get amount() {
  let result = 40000;
  if (this.performance.audience > 30) {
    result += 1000 * (this.performance.audience - 30);
  }
  return result;
}
```

`PerformanceCalculator`ì˜ ì¡°ê±´ë¶€ë¡œì§ì´ ì˜¤ë²„ë¼ì´ë“œ ëœë‹¤.

```javascript
get amount() {
  let result = 0;
  switch (this.play.type) { 
    case "tragedy":
      throw 'ì˜¤ë¥˜ ë°œìƒ'; // ë¹„ê·¹ ê³µì—°ë£ŒëŠ” TragedyCalculatorë¥¼ ì´ìš©í•˜ë„ë¡ ìœ ë„
    case "comedy":
      result = 30000;
      if (this.performance.audience > 20) {
        result += 1000 + 500 * (this.performance.audience - 20);
      }
      result += 300 * this.performance.audience
      break;
    default:
      throw new Error(`ì•Œ ìˆ˜ ì—†ëŠ” ì¥ë¥´: ${this.play.type}`);
    }
}
```

ğŸ¬ í¬ê·¹ ê³µì—°ì˜ ê³µì—°ë£Œ ê³„ì‚°

```javascript
get amount() {
  let result = 30000;
  if (this.performance.audience > 20) {
    result += 1000 + 500 * (this.performance.audience - 20);
  }
  return result;
}
```

ìŠˆí¼ í´ë˜ìŠ¤ì˜ `amount()` ë©”ìŠ¤ë“œëŠ” í˜¸ì¶œí•  ì¼ì´ ì—†ã„·ìœ¼ë‹ˆ ì‚­ì œí•´ë„ ì¢‹ìœ¼ë‚˜ ë¯¸ë˜ì˜ ë‚˜ë¥¼ ìœ„í•´ í•œë§ˆë”” ë‚¨ê²¨ë†“ì.

```javascript
// PerformanceCalculator í´ë˜ìŠ¤
get amount() {
  throw new Error('ì„œë¸Œí´ë˜ìŠ¤ì—ì„œ ì²˜ë¦¬í•˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.');
}
```

ğŸ’° ì ë¦½ í¬ì¸íŠ¸ ì¡°ê±´ë¶€ ë¡œì§ êµì²´í•˜ê¸°

ì¼ë°˜ì ì¸ ê²½ìš°ë¥¼ ê¸°ë³¸ìœ¼ë¡œ ì‚¼ì•„ ìŠˆí¼í´ë˜ìŠ¤ì— ë‚¨ê²¨ë‘ê³ , ì¥ë¥´ë§ˆë‹¤ ë‹¬ë¼ì§€ëŠ” ë¶€ë¶„ì€ í•„ìš”í•  ë•Œ, ì˜¤ë²„ë¼ì´ë“œí•˜ê²Œ ë§Œë“œëŠ” ê²ƒì´ ì¢‹ë‹¤. í¬ì¸íŠ¸ ë°©ì‹ì´ ì¡°ê¸ˆ ë‹¤ë¥¸ í¬ê·¹ ì²˜ë¦¬ ë¡œì§ì„ í•´ë‹¹ ì„œë¸Œí´ë˜ìŠ¤ë¡œ ë‚´ë¦°ë‹¤.

```javascript
get volumeCredits() {
  return Math.max(this.performance.audience - 30, 0);
}
```

```javascript
get volumeCredits() {
  return super.volumeCredits + Math.floor(this.performance.audience / 5);
}
```
