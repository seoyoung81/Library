# âœï¸ 1.6 ê³„ì‚° ë‹¨ê³„ì™€ í¬ë§·íŒ… ë‹¨ê³„ ë¶„ë¦¬í•˜ê¸°

## ëª©í‘œ

`statement()`ì˜ HTML ë²„ì „ ë§Œë“œëŠ” ì‘ì—…



### ë‹¨ê³„ ìª¼ê°œê¸°

1. `statement()`ì— í•„ìš”í•œ ë°ì´í„° ì²˜ë¦¬í•˜ê¸° â†’ ë‘ ë²ˆì§¸ ë‹¨ê³„ë¡œ ì „ë‹¬í•  ì¤‘ê°„ ë°ì´í„° êµ¬ì¡°ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒ
2. ì•ì„œ ì²˜ë¦¬í•œ ê²°ê³¼ë¥¼ í…ìŠ¤íŠ¸ë‚˜ HTMLë¡œ í‘œí˜„í•˜ê¸°

0\. ë‹¨ê³„ë¥¼ ìª¼ê°œë ¤ë©´ ë¨¼ì € ë‘ ë²ˆì§¸ ë‹¨ê³„ê°€ ë  ì½”ë“œë“¤ì„ **í•¨ìˆ˜ ì¶”ì¶œí•˜ê¸°**ë¡œ ë½‘ì•„ë‚´ì•¼ í•œë‹¤. í˜„ì¬ statement()ì˜ ë³¸ë¬¸ ì „ì²´ê°€ ì—¬ê¸°ì— í•´ë‹¹í•œë‹¤.

```javascript
function statement(invoice, plays) {
  return renderPlainText(invoice, plays); // ë³¸ë¬¸ ì „ì²´ë¥¼ ë³„ë„ í•¨ìˆ˜ë¡œ ì¶”ì¶œ
}

function renderPlainText(invoice, plays) {
  let result = `ì²­êµ¬ ë‚´ì—­(ê³ ê°ëª…): ${invocie.customer})\n`;
  
  for (let perf of invoice.performaces) {
    // ì²­êµ¬ ë‚´ì—­ì„ ì¶œë ¥í•œë‹¤.
    result += ` ${playFor(perf).name}: ${usd(amountFor(perf))} ($perf.audience}ì„)\n`;
  
  result += `ì´ì•¡: ${usd(totalAmount())}\n`;	
  result += `ì ë¦½ í¬ì¸íŠ¸: ${totalVolumeCredits()}ì \n`;
  return result;
  
  function totalAmount() {...}
  function totalVolumeCredits() {...}
  function usd(aNumber) {...}
  function volumeCreditsFor(aPerformance) {...}
  function playFor(aPerformance) {...}
  function amountFor(aPerformance) {...}
}

```

<mark style="background-color:yellow;">í•­ìƒ ìˆ˜ì •í•œ ì½”ë“œëŠ” ì»´íŒŒì¼-í…ŒìŠ¤íŠ¸-ì»¤ë°‹í•œë‹¤.</mark>

ë‹¤ìŒìœ¼ë¡œ ë‘ ë‹¨ê³„ ì‚¬ì´ì˜ ì¤‘ê°„ ë°ì´í„° êµ¬ì¡° ì—­í• ì„ í•  ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ `renderPlainText()`ì— ì¸ìˆ˜ë¡œ ì „ë‹¬í•œë‹¤.

```javascript
function statement(invoice, plays) {
  const statementData = {};
  return renderPainText(statementData, invoice, plays); // ì¤‘ê°„ ë°ì´í„° êµ¬ì¡°ë¥¼ ì¸ìˆ˜ë¡œ ì „ë‹¬
}

funtion renderPlainText(data, invoice, plays) { // ì¤‘ê°„ ë°ì´í„° êµ¬ì¡°ë¥¼ ì¸ìˆ˜ë¡œ ì „ë‹¬    
  let result = `ì²­êµ¬ ë‚´ì—­(ê³ ê°ëª…): ${invocie.customer})\n`;
  
  for (let perf of invoice.performaces) {
    // ì²­êµ¬ ë‚´ì—­ì„ ì¶œë ¥í•œë‹¤.
    result += ` ${playFor(perf).name}: ${usd(amountFor(perf))} ($perf.audience}ì„)\n`;
  
  result += `ì´ì•¡: ${usd(totalAmount())}\n`;	
  result += `ì ë¦½ í¬ì¸íŠ¸: ${totalVolumeCredits()}ì \n`;
  return result;
  
  function totalAmount() {...}
  function totalVolumeCredits() {...}
  function usd(aNumber) {...}
  function volumeCreditsFor(aPerformance) {...}
  function playFor(aPerformance) {...}
  function amountFor(aPerformance) {...}
```

`renderPlainText()`ì˜ ë‹¤ë¥¸ ë‘ ì¸ìˆ˜(invoiceì™€ plays)ë¥¼ ì‚´í´ë³´ì. ì´ ì¸ìˆ˜ë“¤ì„ í†µí•´ ì „ë‹¬ë˜ëŠ” ë°ì´í„°ë¥¼ ì¤‘ê°„ ë°ì´í„° êµ¬ì¡°ë¡œ ì˜®ê¸°ë©´, ê³„ì‚° ê´€ë ¨ ì½”ë“œëŠ” `statement()` í•¨ìˆ˜ë¡œ ëª¨ìœ¼ê³  `renderPlainText()`ëŠ” data ë§¤ê°œë³€ìˆ˜ë¡œ ì „ë‹¬ëœ ë°ì´í„°ë§Œ ì²˜ë¦¬í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆë‹¤.



ê°€ì¥ ë¨¼ì € ê³ ê° ì •ë³´ë¶€í„° ì¤‘ê°„ ë°ì´í„° êµ¬ì¡°ë¡œ ì˜®ê¸´ë‹¤.

```javascript
function statement(invoice, plays) {
  const statementData = {};
  statementData.customer = invoice.customer; // ê³ ê° ë°ì´í„°ë¥¼ ì¤‘ê°„ ë°ì´í„°ë¡œ ì˜®ê¹€
  return renderPainText(statementData, invoice, plays);
}

funtion renderPlainText(data, invoice, plays) {
  let result = `ì²­êµ¬ ë‚´ì—­(ê³ ê°ëª…): ${data.customer})\n`;	// ê³ ê° ë°ì´í„°ë¥¼ ì¤‘ê°„ ë°ì´í„°ë¡œë¶€í„° ì–»ìŒ
  
  for (let perf of invoice.performaces) {
    // ì²­êµ¬ ë‚´ì—­ì„ ì¶œë ¥í•œë‹¤.
    result += ` ${playFor(perf).name}: ${usd(amountFor(perf))} ($perf.audience}ì„)\n`;
  
  result += `ì´ì•¡: ${usd(totalAmount())}\n`;	
  result += `ì ë¦½ í¬ì¸íŠ¸: ${totalVolumeCredits()}ì \n`;
  return result;
```

ê°™ì€ ë°©ì‹ìœ¼ë¡œ ê³µì—° ì •ë³´ê¹Œì§€ ì¤‘ê°„ ë°ì´í„° êµ¬ì¡°ë¡œ ì˜®ê¸°ê³  ë‚˜ë©´ `renderPlainText()`ì˜ `invoice` ë§¤ê°œë³€ìˆ˜ë¥¼ ì‚­ì œí•´ë„ ëœë‹¤.

```javascript
function statement(invoice, plays) {
  const statementData = {};
  statementData.customer = invoice.customer; 
  statementData.performances = invoice.performances;	// ê³µì—° ì •ë³´ë¥¼ ì¤‘ê°„ ë°ì´í„°ë¡œ ì˜®ê¹€
  return renderPainText(statementData, ~~invoice~~, plays);	// í•„ìš” ì—†ì–´ì§„ ì¸ìˆ˜ ì‚­ì œ
}

funtion renderPlainText(data, plays) {
  let result = `ì²­êµ¬ ë‚´ì—­(ê³ ê°ëª…): ${data.customer})\n`;
  
  for (let perf of data.performances) {
    // ì²­êµ¬ ë‚´ì—­ì„ ì¶œë ¥í•œë‹¤.
    result += ` ${playFor(perf).name}: ${usd(amountFor(perf))} ($perf.audience}ì„)\n`;
  
  result += `ì´ì•¡: ${usd(totalAmount())}\n`;	
  result += `ì ë¦½ í¬ì¸íŠ¸: ${totalVolumeCredits()}ì \n`;
  return result;
```

```javascript
function totalAmount() {
  let result = 0;	
  for (let perf of data.performances) {
    totalAmount += amountFor(perf);
  }
  return result;
}
  
function totalVolumeCredits() {
  let voluemCredits = 0;
  for (let perf of data.performances) {
    volumeCredits += volumeCreditsFor(perf);
  }
  return volulmeCredits;
}
```

ì—°ê·¹ ì œëª©ë„ ì¤‘ê°„ ë°ì´í„° êµ¬ì¡°ì—ì„œ ê°€ì ¸ì˜¤ë„ë¡ í•œë‹¤. ì´ë¥¼ ìœ„í•´ ê³µì—° ì •ë³´ ë ˆì½”ë“œì— ì—°ê·¹ ë°ì´í„°ë¥¼ ì¶”ê°€í•´ì•¼ í•œë‹¤.

```javascript
function statement(invoice, plays) {
  const statementData = {};
  statementData.customer = invoice.customer; 
  statementData.performances = invoice.performances;	
  return renderPainText(statementData, plays);
}

function enrichPerformance(aPerformance) {
  const result = Object.assign({}, aPerformance); // ì–•ì€ ë³µì‚¬ ìˆ˜í–‰
  return result;
}
```

ê³µì—° ê°ì²´ë¥¼ ë³µì‚¬ë§Œ í–ˆì§€ë§Œ(í•¨ìˆ˜ë¡œ ê±´ë„¨ ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ê¸° ì‹«ì–´ì„œ) ì ì‹œ í›„ ìƒˆë¡œ ë§Œë“  ë ˆì½”ë“œì— ë°ì´í„°ë¥¼ ì±„ìš¸ ê²ƒì´ë‹¤. ê°€ë³€ ë°ì´í„°ëŠ” ê¸ˆë°© ìƒí•˜ê¸° ë•Œë¬¸ì— ë°ì´í„°ë¥¼ ìµœëŒ€í•œ ë¶ˆë³€(immutable)ì²˜ëŸ¼ ì·¨ê¸‰í•œë‹¤.



<mark style="background-color:purple;">ì‹¤ì œë¡œ ë°ì´í„°ë¥¼ ë‹´ì•„ë³´ì</mark>

#### í•¨ìˆ˜ ì˜®ê¸°ê¸°ë¥¼ ì ìš©í•˜ì—¬ `playFor()` í•¨ìˆ˜ë¥¼ `statement()`ë¡œ ì˜®ê¸´ë‹¤

```javascript
function enrichPerformance(aPerformance) {
  const result = Object.assign({}, aPerformance); 
  result.play = playFor(result);  // ì¤‘ê°„ ë°ì´í„°ì— ì—°ê·¹ ì •ë³´ë¥¼ ì €ì¥
  return result;
}

function playFor(aPerformance) {  // renderPlainText()ì˜ ì¤‘ì²©í•¨ìˆ˜ì˜€ë˜ playFor()ë¥¼ statement()ë¡œ ì˜®ê¹€
  return plays[aPerformance.playID];
}
```

`renderPlainText()`ì•ˆì—ì„œ `playFor()`ë¥¼ í˜¸ì¶œí•˜ë˜ ë¶€ë¶„ì„ ì¤‘ê°„ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ë°”ê¾¼ë‹¤.

```javascript
let result = `ì²­êµ¬ ë‚´ì—­(ê³ ê°ëª…): ${data.customer})\n`;
  
for (let perf of data.performances) {
  result += ` ${perf.play.name} ${usd(amountFor(perf))} ($perf.audience}ì„)\n`;
  // ì¤‘ê°„ ë°ì´í„° ì‚¬ìš©
result += `ì´ì•¡: ${usd(totalAmount())}\n`;	
result += `ì ë¦½ í¬ì¸íŠ¸: ${totalVolumeCredits()}ì \n`;
return result;

function volumeCreditsFor(aPerformance) { 
  let result = 0;
  volumeCredits += Math.max(aPerformance.audience - 30, 0);
  if ("comedy" === playFor(aPerformance).type) 
    volumeCredits += Math.Floor(aPerformance.audience / 5 );
  return result;
}

function amountFor(aPerformance) {
  let result = 0;
  switch (playFor(aPerfomance).type) { 
  case "tragedy":
    result = 40000;
    if (perf.audience > 30) {
      result += 1000 * (perf.audience - 30);
    }
    break;
  case "comedy":
    result = 30000;
    if (perf.audience > 20) {
      result += 1000 + 500 * (perf.audience - 20);
    }
    result += 300 * perf.audience
    break;
  default:
    throw new Error(`ì•Œ ìˆ˜ ì—†ëŠ” ì¥ë¥´: ${playFor(aPerfomance).type}`);
  }
  return result;
}
```

`amountFor()`ë„ ë¹„ìŠ·í•œ ë°©ë²•ìœ¼ë¡œ ì˜®ê¸´ë‹¤.

```javascript
function enrichPerformance(aPerformance) {
  const result = Object.assign({}, aPerformance); 
  result.play = playFor(result); 
  result.amount = amountFor(result);  // ì¤‘ê°„ ë°ì´í„° ì‚¬ìš© 
  return result;
}

function amountFor(aPerformance) {...}
```

```javascript
let result = `ì²­êµ¬ ë‚´ì—­(ê³ ê°ëª…): ${invocie.customer})\n`;
  
for (let perf of invoice.performaces) {
  result += ` ${playFor(perf).name}: ${usd(perf.amount)} ($perf.audience}ì„)\n`;  // ì¤‘ê°„ ë°ì´í„°

result += `ì´ì•¡: ${usd(totalAmount())}\n`;	
result += `ì ë¦½ í¬ì¸íŠ¸: ${totalVolumeCredits()}ì \n`;
return result;

function totalAmount() {
  let result = 0;
  for (let perf of data.performances) {
    result += perf.amount;  // ì¤‘ê°„ ë°ì´í„°
  }
  return result;
}
```

ì ë¦½ í¬ì¸íŠ¸ ê³„ì‚° ë¶€ë¶„ì„ ì˜®ê¸´ë‹¤.

```javascript
function enrichPerformance(aPerformance) {
  const result = Object.assign({}, aPerformance); 
  result.play = playFor(result); 
  result.amount = amountFor(result);
  result.volumeCredits = volumeCreidtsFor(result);
  return result;
}
```

```javascript
function totalVolumeCredits() {
  let result = 0;
  for (let perf of data.performances) {
    result += perf.voluemCredits;
  }
  return result;
}
```

ì´í•©ì„ êµ¬í•˜ëŠ” ë¶€ë¶„ì„ ì˜®ê¸´ë‹¤.

```javascript
const statementData = {};
statementData.customer = invoice.customer; 
statementData.performances = invoice.performances.map(enrichPerformance);
statementData.totalAmount = totalAmount(statmentData);	
statementData.totalVolumeCredits = totalVolumeCredits(statementData);
return renderPlainText(statementData, plays)

function totalAmount(data) {...}
function totalVolumeCredits(data) {...}	
```

```javascript
let result = `ì²­êµ¬ ë‚´ì—­(ê³ ê°ëª…): ${data.customer})\n`;
  
for (let perf of data.performaces) {
  result += ` ${playFor(perf).name}: ${usd(perf.amount)} ($perf.audience}ì„)\n`;

result += `ì´ì•¡: ${usd(data.totalAmount)}\n`;	
result += `ì ë¦½ í¬ì¸íŠ¸: ${data.totalVolumeCredits}ì \n`;
return result;
```

`totalAmount()`ì™€ `totalVolumeCredits()`ë¥¼ ì§ì ‘ statementData ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ë„ ìˆì§€ë§Œ ì €ìëŠ” ë§¤ê°œë³€ìˆ˜ë¡œ ì „ë‹¬í•˜ëŠ” ë°©ì‹ì„ ì„ í˜¸í•œë‹¤.



#### ë°˜ë³µë¬¸ì„ íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ ë°”ê¾¸ê¸°ë¥¼ ì ìš©í•´ë³´ì

```javascript
function totalAmount(data) {
  return data.performances  // for ë°˜ë³µë¬¸ì„ íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ ë°”ê¿ˆ
    .reduce((total, p) => total + p.amount, 0);
}
function totalVolumeCredits(data) {
  return data.performances
    .reduce((total, p) => total + p.volumeCredits, 0); // for ë°˜ë³µë¬¸ì„ íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ ë°”ê¿ˆ
```

#### ğŸ“ ì²« ë‹¨ê³„ì¸ `statement()`ì— í•„ìš”í•œ ë°ì´í„° ì²˜ë¦¬ì— í•´ë‹¹í•˜ëŠ” ì½”ë“œë¥¼ ëª¨ë‘ ë³„ë„ í•¨ìˆ˜ë¡œ ë¹¼ë‚¸ë‹¤.

```javascript
function statement(invoice, plays) {
  return renderPlainText(createStatementData(invoice, plays));
}

function createdStatementData(invoice, plays) {  // ì¤‘ê°„ ë°ì´í„°ë¥¼ ì „ë‹¬
  const statementData = {};
  statementData.customer = invoice.customer; 
  statementData.performances = invoice.performances.map(enrichPerformance);
  statementData.totalAmount = totalAmount(statmentData);	
  statementData.totalVolumeCredits = totalVolumeCredits(statementData);
  return statementData;
```

ë‘ ë‹¨ê³„ê°€ ëª…í™•íˆ ë¶„ë¦¬ ëìœ¼ë‹ˆ ê° ì½”ë“œë¥¼ ë³„ë„ íŒŒì¼ì— ì €ì¥í•œë‹¤. ë°˜í™˜ ê²°ê³¼ë¥¼ ì €ì¥í•  ë³€ìˆ˜ì˜ ì´ë¦„ë„ ë°”ê¿”ì¤€ë‹¤.

```javascript
// statement.js
import createdStatementData from './createStatementData.js';
```

```javascript
// createStatementData.js
export default function createdStatementData(invoice, plays) {
  const result = {};
  result.customer = invoice.customer; 
  result.performances = invoice.performances.map(enrichPerformance);
  result.totalAmount = totalAmount(result);	
  result.totalVolumeCredits = totalVolumeCredits(result);
  return result;
  
  function enrichPerformance(aPerformance) {...}
  function playFor(aPerformance) {...}
  function amountFor(aPerformance) {...}
  function volumeFor(aPerformance) {...}
  function totalAmount(data) {...}
  function totalVolumeCredits(data) {...}
```



â­ï¸ ë§ˆì§€ë§‰ìœ¼ë¡œ ì»´íŒŒì¼-í…ŒìŠ¤íŠ¸-ì»¤ë°‹í•˜ë©´ HTML ë²„ì „ì„ ì‘ì„±í•  ì¤€ë¹„ê°€ ëë‚œë‹¤.

```javascript
// statement.js
function htmlStatment(invoice, plays) {
  return renderHtml(createStatementData(invoice, plays)); // ì¤‘ê°„ ë°ì´í„° ìƒì„± í•¨ìˆ˜ë¥¼ ê³µìœ 
}

function renderHtml(data) {
  let result = `<h1>ì²­êµ¬ ë‚´ì—­(ê³ ê°ëª…): ${data.customer})</h1>\n`;
  result += "<table>\n";
  
  ...
    
  return result;
```

