# βοΈ 9.3 νμƒ λ³€μλ¥Ό μ§μ ν•¨μλ΅ λ°”κΎΈκΈ° (Replace Derived Variable with Query)

λ¦¬ν©ν„°λ§ μ „

```javascript
get discountedTotal() {return this._discountedTotal;}
set discount(aNumber) {
  const old = this._discount;
  this._discount = aNumber;
  this._discountedTotal += old - aNumber;
}
```

λ¦¬ν©ν„°λ§ ν›„

```javascript
get discountedTotal() {return this._baseTotal - this._discount;}
set discount(aNumber) {this._discount = aNumber;}
```

## π§· λ°°κ²½

κ°€λ³€ λ°μ΄ν„°λ” μ„λ΅ λ‹¤λ¥Έ λ‘ μ½”λ“λ¥Ό κ²°ν•©ν•κΈ°λ„ ν•λ”λ°, ν• μ½ μ½”λ“μ—μ„ μμ •ν• κ°’μ΄ μ—°μ‡„ ν¨κ³Όλ¥Ό μΌμΌμΌ λ‹¤λ¥Έ μ½ μ½”λ“μ— μ›μΈμ„ μ°ΎκΈ° νλ“  λ¬Έμ λ¥Ό μ•ΌκΈ°ν•κΈ°λ„ ν•λ‹¤. κ°€λ³€ λ°μ΄ν„°λ¥Ό μ™„μ „ν λ°°μ ν•κΈ°λ€ λ¶κ°€λ¥ν•λ―€λ΅, κ°€λ³€ λ°μ΄ν„°μ μ ν¨ λ²”μ„λ¥Ό κ°€λ¥ν• μΆνλ” λ°©λ²•μ„ μ°Ύμ•„μ•Ό ν•λ‹¤.

## π§· μ μ°¨

1. λ³€μ κ°’μ΄ κ°±μ‹ λλ” μ§€μ μ„ λ¨λ‘ μ°Ύλ”λ‹¤. ν•„μ”ν•λ©΄ λ³€μ μΌκ°κΈ°λ¥Ό ν™μ©ν•΄ κ° κ°±μ‹  μ§€μ μ—μ„ λ³€μλ¥Ό λ¶„λ¦¬ν•λ‹¤.
2. ν•΄λ‹Ή λ³€μμ κ°’μ„ κ³„μ‚°ν•΄μ£Όλ” ν•¨μλ¥Ό λ§λ“ λ‹¤.
3. ν•΄λ‹Ή λ³€μκ°€ μ‚¬μ©λλ” λ¨λ“  κ³³μ— μ–΄μ„μ…(assertion)μ„ μ¶”κ°€(10.6μ )ν•μ—¬ ν•¨μμ κ³„μ‚° κ²°κ³Όκ°€ λ³€μμ κ°’κ³Ό κ°™μ€μ§€ ν™•μΈν•λ‹¤.
   * ν•„μ”ν•λ©΄ λ³€μ μΊ΅μν™”ν•κΈ°(6.6μ )λ¥Ό μ μ©ν•μ—¬ μ–΄μ„μ…μ΄ λ“¤μ–΄κ° μ¥μ†λ¥Ό λ§λ ¨ν•΄μ¤€λ‹¤.
4. ν…μ¤νΈν•λ‹¤.
5. λ³€μλ¥Ό μ½λ” μ½”λ“λ¥Ό λ¨λ‘ ν•¨μ νΈμ¶λ΅ λ€μ²΄ν•λ‹¤.
6. ν…μ¤νΈν•λ‹¤.
7. λ³€μλ¥Ό μ„ μ–Έν•κ³  κ°±μ‹ ν•λ” μ½”λ“λ¥Ό μ£½μ€ μ½”λ“ μ κ±°ν•κΈ°(8.9μ )λ΅ μ—†μ•¤λ‹¤.

## π§· μμ‹

```javascript
// ProductionPlan ν΄λμ¤ ...
get production() {return this._production;}
applyAdjustment(anAdjustment) {
    this._adjustments.push(anAdjustment);
    this._production += anAdjustment.amount;
}
```

λ°μ΄ν„° μ¤‘λ³µμ„ μ¤„μ—¬λ³΄μ.

1. μ–΄μ…”μ„ μ„ μ¶”κ°€ν•μ—¬ μ΄ κ°’μ„ κ³„μ‚°ν•΄λ‚Ό μ μλ”μ§€ ν™•μΈν•λ‹¤.

```javascript
// ProductionPlan ν΄λμ¤ ...
get production() {
    assert(this._production === this.caculatedProduction);
    return this._production;
}

get caculatedProduction() {
    return this._adjustments
        .reduce((sum, a) => sum += a.amount, 0);
}
```

2. μ–΄μ„μ…μ΄ μ‹¤ν¨ν•μ§€ μ•μΌλ©΄ ν•„λ“λ¥Ό λ°ν™ν•λ μ½”λ“λ¥Ό μμ •ν•μ—¬ κ³„μ‚° κ²°κ³Όλ¥Ό μ§μ ‘ λ°ν™ν•λ„λ΅ ν•λ‹¤.
3. `calculatedProduction()` λ©”μ„λ“λ¥Ό μΈλΌμΈν•λ‹¤.
4. μ› λ³€μλ¥Ό μ°Έμ΅°ν•λ” λ¨λ“  μ½”λ“λ” μ κ±°ν•λ‹¤.

```javascript
// ProductionPlan ν΄λμ¤ ...
get production() {
    return this.caculatedProduction;
}

get caculatedProduction() {
    return this._adjustments
        .reduce((sum, a) => sum += a.amount, 0);
}

applyAdjustment(anAdjustment) {
    this._adjustments.push(anAdjustment);
}
```



## π§· μμ‹: μ†μ¤κ°€ λ‘ μ΄μƒμΌ λ•

```javascript
// ProductionPlan ν΄λμ¤ ...
constructor(production) {
    this._production = production;
    this._adjustments = [];
}

get production() {return this._production;}

applyAdjustment(anAdjustment) {
    this._adjustments.push(anAdjustment);
    this._production += anAdjustment.amount;
}
```

μ–΄μ„μ…μ„ μ¶”κ°€ν•λ©΄ `_production`μ μ΄κΈ°κ°’μ΄ 0μ΄ μ•„λ‹λ©΄ μ‹¤ν¨ν•λ‹¤.

1. λ³€μ μΌκ°κΈ°λ¥Ό λ¨Όμ € μ μ©ν•λ‹¤.

```javascript
// ProductionPlan ν΄λμ¤ ...
constructor(production) {
    this._initialProduction = production;
    this.productionAccumulator = 0;
    this._adjustments = [];
}

get production() {
    return this._initialProduction + this._productionAccumulator;
}
```

2. μ–΄μ„μ…μ„ μ¶”κ°€ν•λ‹¤.

```javascript
// ProductionPlan ν΄λμ¤ ...
constructor(production) {
    this._initialProduction = production;
    this.productionAccumulator = 0;
    this._adjustments = [];
}

get calculatedProductionAcumulator() {
    return this._adjustments
        .reduce((sum, a) => sum + a.amount, 0);
}
```

μ΄ λ‹¤μμ€ μ΄μ „κ³Ό κ±°μ κ°™λ‹¤.
